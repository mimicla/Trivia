<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Trivia</title>
    <link rel="stylesheet" href="res/styles/jquery.mobile-1.3.2.min.css"/>
    <script src="res/js/jquery-1.9.1.min.js"></script>
    <script src="res/js/jquery.mobile-1.3.2.min.js"></script>
    <script src="res/js/cordova.js"></script>
</head>
<body>

<div data-role="page" id="question-page">
    <div data-role="header">
        <a href="#home" data-role="button" data-mini="true" data-direction="reverse">Quit</a>

        <h1>Q#132</h1>
    </div>
    <div data-role="content">
        <h3>Question: What is this thing I have to ask as a place holder so it looks like a real trivia question?</h3>
        <ul data-role="listview" data-inset="true">
            <li><a href="#" data-rel="popup" data-transition="slide">Option 1</a></li>
            <li><a href="#" data-rel="popup" data-transition="slide">Option 2</a></li>
            <li><a href="#" data-rel="popup" data-transition="slide">Option 3</a></li>
            <li><a href="#" data-rel="popup" data-transition="slide">Option 4</a></li>
        </ul>
    </div>
    <div id="correctpop1" data-role="popup" data-theme="e">
        <h1>Correct!</h1>
    </div>
    <div id="pop1" data-role="popup" data-theme="b">
        <h1>Wrong</h1>
    </div>
</div>

<div data-role="page" id="question-page2">
    <div data-role="header">
        <a href="#home" data-role="button" data-mini="true" data-direction="reverse">Quit</a>

        <h1>Q#132</h1>
    </div>
    <div data-role="content">
        <h3>Question: What is this thing I have to ask as a place holder so it looks like a real trivia question?</h3>
        <ul data-role="listview" data-inset="true">
            <li><a href="#" data-rel="popup" data-transition="slide">Option 1</a></li>
            <li><a href="#" data-rel="popup" data-transition="slide">Option 2</a></li>
            <li><a href="#" data-rel="popup" data-transition="slide">Option 3</a></li>
            <li><a href="#" data-rel="popup" data-transition="slide">Option 4</a></li>
        </ul>
    </div>
    <div id="correctpop2" data-role="popup" data-theme="e">
        <h1>Correct!</h1>
    </div>
    <div id="pop2" data-role="popup" data-theme="b">
        <h1>Wrong</h1>
    </div>
</div>

<div data-role="page" id="no-more-questions-page">
    <div data-role="header">
        <a href="#home" data-role="button" data-mini="true" data-direction="reverse">Quit</a>

        <h1>No more questions</h1>
    </div>
    <div data-role="content" data-theme="e">
        <h3>Sorry, there are no more questions left</h3>
        <p>If you don't mind repeating the same questions, you can restart <a href="#question-page?num=restart">here</a></p>
    </div>
</div>
</body>
</html>

<script>


    $(document).bind("pagebeforechange", function (e, data) {
        // only handle changePage() when loading a page by URL.

        if (typeof data.toPage === "string") {
            // Handle URLs that request chapter page
            var url = $.mobile.path.parseUrl(data.toPage);
            var regex = /^#question-page/;
            if (url.hash.search(regex) !== -1) {
                showQuestion(url, data.options);
                // tell changePage() we've handled this
                e.preventDefault();

            }
        }
    });


    function showQuestion(urlObj, options) {
        var data = myquestions;

        var questionNumber = urlObj.hash.replace(/.*num=/, "");
        var $page;
        var pagen;
        var quest;
        if (questionNumber == 'next') {
            if(count >= data.length){
                $.mobile.changePage($('#no-more-questions-page'), options);
                return;
            }
            questionNumber = data[count].id;
            quest = data[count];
        }else if (questionNumber == 'restart') {
            shuffle(data);
            count = 0;
            questionNumber = data[0].id;
            quest = data[0];
        }else if(isNaN(questionNumber)){
            return;
        } else {
            alert(questionNumber);
            quest = data[questionNumber];
        }

        if ($.mobile.activePage.attr("id") == "question-page") {
            $page = $("#question-page2");
            pagen = 2;
        } else {
            $page = $("#question-page");
            pagen = 1;
        }

        // Get the header for the page.
        var $header = $page.children(":jqmData(role='header')");

        // Get the content area element for the page.
        var $content = $page.children(":jqmData(role='content')");

        // Find the h1 element in our header and inject the name of
        // the category into it.
        $header.find("h1").html('Q#' + questionNumber);

        $content.find("h3")[0].innerHTML = quest.question;

        var choices = $content.find("a");
        var ops = [quest.choice1, quest.choice2, quest.choice3, quest.choice4]
        var ansi = ops[quest.answer-1];
        shuffle(ops);
        choices[0].innerHTML = ops[0];
        choices[1].innerHTML = ops[1];
        choices[2].innerHTML = ops[2];
        choices[3].innerHTML = ops[3];

        choices[0].href = '#pop' + pagen;
        choices[1].href = '#pop' + pagen;
        choices[2].href = '#pop' + pagen;
        choices[3].href = '#pop' + pagen;

        var aq;
        for(it in choices){
            if(choices[it].innerHTML == ansi){
                aq = choices[it];
                break;
            }
        }

        $(aq).bind("click", function (event, ui) {
            $(aq).unbind("click");
            count += 1;

            $(aq).attr('href', '#correctpop' + pagen)

            tim = setTimeout(function () {
                choices[0].href = '#pop' + pagen;
                choices[1].href = '#pop' + pagen;
                choices[2].href = '#pop' + pagen;
                choices[3].href = '#pop' + pagen;
                clearTimeout(tim);
                $.mobile.changePage('#question-page?num=next', {
                    transition: "slide",
                    showLoadMsg: false
                });
                choices[0].href = '#pop' + pagen;
                choices[1].href = '#pop' + pagen;
                choices[2].href = '#pop' + pagen;
                choices[3].href = '#pop' + pagen;
            }, 500);


        });

        //var cur = choices[0];

        $page.page();
        $content.find(":jqmData(role='listview')").listview();
        options.dataUrl = urlObj.href + '?num=' + questionNumber;
        $.mobile.changePage($page, options);

    }

</script>